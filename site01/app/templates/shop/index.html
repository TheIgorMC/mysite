{% extends "base.html" %}

{% block title %}{{ t('shop.title') }} - {{ super() }}{% endblock %}

{% block content %}
<section class="py-12 bg-gray-100 dark:bg-gray-900">
    <div class="container mx-auto px-4">
        <h1 class="text-4xl font-bold text-center mb-12 text-gray-900 dark:text-white">{{ t('shop.title') }}</h1>
        
        <!-- Category Filter -->
        <div class="flex justify-center mb-8">
            <!-- Desktop View -->
            <div class="hidden md:inline-flex rounded-lg shadow-sm" role="group">
                <a href="{{ url_for('shop.index', category='all') }}" 
                   class="px-6 py-2 text-sm font-medium {% if category == 'all' %}bg-primary text-white{% else %}bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700{% endif %} border border-gray-200 dark:border-gray-600 rounded-l-lg transition">
                    {{ t('shop.all') }}
                </a>
                <a href="{{ url_for('shop.index', category='archery') }}" 
                   class="px-6 py-2 text-sm font-medium {% if category == 'archery' %}bg-primary text-white{% else %}bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700{% endif %} border-t border-b border-gray-200 dark:border-gray-600 transition">
                    {{ t('shop.archery') }}
                </a>
                <a href="{{ url_for('shop.index', category='3dprinting') }}" 
                   class="px-6 py-2 text-sm font-medium {% if category == '3dprinting' %}bg-primary text-white{% else %}bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700{% endif %} border-t border-b border-gray-200 dark:border-gray-600 transition">
                    {{ t('shop.printing') }}
                </a>
                <a href="{{ url_for('shop.index', category='electronics') }}" 
                   class="px-6 py-2 text-sm font-medium {% if category == 'electronics' %}bg-primary text-white{% else %}bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700{% endif %} border border-gray-200 dark:border-gray-600 rounded-r-lg transition">
                    {{ t('shop.electronics') }}
                </a>
            </div>
            
            <!-- Mobile View: Dropdown -->
            <div class="md:hidden w-full max-w-sm">
                <select onchange="window.location.href=this.value" 
                        class="w-full px-4 py-3 text-sm font-medium bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 border border-gray-200 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary transition">
                    <option value="{{ url_for('shop.index', category='all') }}" {% if category == 'all' %}selected{% endif %}>
                        {{ t('shop.all') }}
                    </option>
                    <option value="{{ url_for('shop.index', category='archery') }}" {% if category == 'archery' %}selected{% endif %}>
                        {{ t('shop.archery') }}
                    </option>
                    <option value="{{ url_for('shop.index', category='3dprinting') }}" {% if category == '3dprinting' %}selected{% endif %}>
                        {{ t('shop.printing') }}
                    </option>
                    <option value="{{ url_for('shop.index', category='electronics') }}" {% if category == 'electronics' %}selected{% endif %}>
                        {{ t('shop.electronics') }}
                    </option>
                </select>
            </div>
        </div>
        
        <!-- Products Grid -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            {% for product in products %}
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition-shadow duration-300">
                <a href="{{ url_for('shop.product_detail', product_id=product.id) }}" class="block overflow-hidden">
                    <div class="relative h-48 bg-gray-200 dark:bg-gray-700">
                        <img src="{{ url_for('static', filename='uploads/' + (product.main_image or 'placeholder.jpg')) }}" 
                             alt="{{ product.name_it if session.get('language') == 'it' else product.name_en }}" 
                             class="absolute inset-0 w-full h-full object-contain p-2 hover:scale-105 transition-transform duration-300">
                    </div>
                </a>
                <div class="p-4">
                    <a href="{{ url_for('shop.product_detail', product_id=product.id) }}" class="block">
                        <h3 class="text-lg font-bold mb-2 truncate text-gray-900 dark:text-white hover:text-primary transition">
                            {{ product.name_it if session.get('language') == 'it' else product.name_en }}
                        </h3>
                    </a>
                    <p class="text-gray-600 dark:text-gray-400 text-sm mb-4 line-clamp-2">
                        {{ product.description_it[:100] if session.get('language') == 'it' else product.description_en[:100] }}...
                    </p>
                    <div class="flex items-center justify-between">
                        <span class="text-2xl font-bold text-primary">
                            â‚¬{{ "%.2f"|format(product.price) }}
                        </span>
                        {% if product.in_stock %}
                            {% if product.is_custom_string or product.is_custom_print %}
                                <!-- Customization required - show customize button -->
                                <a href="{% if product.is_custom_string %}{{ url_for('shop.customize_string', product_id=product.id) }}{% else %}{{ url_for('shop.customize_print', product_id=product.id) }}{% endif %}"
                                   class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition text-sm">
                                    <i class="fas fa-sliders-h"></i>
                                </a>
                            {% elif product.variant_config %}
                                <!-- Has variants - must view details to select options -->
                                <a href="{{ url_for('shop.product_detail', product_id=product.id) }}"
                                   class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition text-sm">
                                    <i class="fas fa-eye"></i> {{ t('shop.select_options') }}
                                </a>
                            {% else %}
                                <!-- Standard add to cart -->
                                <button 
                                    data-product-id="{{ product.id }}"
                                    data-product-name="{{ product.name_it if session.get('language') == 'it' else product.name_en }}"
                                    data-product-price="{{ product.price }}"
                                    data-product-image="/static/uploads/shop/{{ product.main_image }}"
                                    data-product-desc="{{ (product.description_it if session.get('language') == 'it' else product.description_en)|truncate(100) }}"
                                    onclick="addToCartFromButton(this)"
                                    class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-dark transition">
                                    <i class="fas fa-cart-plus"></i>
                                </button>
                            {% endif %}
                        {% else %}
                        <span class="text-red-600 dark:text-red-400 text-sm">{{ t('shop.out_of_stock') }}</span>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% else %}
            <div class="col-span-full text-center py-12">
                <p class="text-gray-500 dark:text-gray-400 text-lg">{{ t('shop.no_products') }}</p>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endblock %}
